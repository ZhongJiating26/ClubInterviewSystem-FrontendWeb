**系统详细设计文档**

**System Detailed Design Specification**

| 版本 |      |             |  Version 2.7   |
|:----:|:----:|:-----------:|:--------------:|
| 时间 |      |             | 2025年12月14日 |
| 编写 |      |             |     钟佳挺     |
| 审核 |      |             | 钟禹帆 王振恺  |
| 小组 |      |             |   肯臭C肯臭V   |
| 历史 |      |             |                |
| V1.0 | 编写 |   钟佳挺    |                |
|      | 审核 | 王硕 钟禹帆 |                |

目录

[第1章 文档概述 [4](#文档概述)](#文档概述)

> [1.1 文档目的 [4](#文档目的)](#文档目的)
>
> [1.2 适用读者 [4](#适用读者)](#适用读者)
>
> [1.3 系统范围 [4](#系统范围)](#系统范围)
>
> [1.4 引用资料 [4](#引用资料)](#引用资料)

[第2章 系统总体设计 [5](#系统总体设计)](#系统总体设计)

> [2.1 系统目标 [5](#系统目标)](#系统目标)
>
> [2.2 系统角色 [5](#系统角色)](#系统角色)
>
> [2.3 技术选型 [5](#技术选型)](#技术选型)
>
> [2.4 系统架构图 [6](#系统架构图)](#系统架构图)
>
> [2.5 系统模块划分 [6](#系统模块划分)](#系统模块划分)

[第3章 功能模块设计 [7](#功能模块设计)](#功能模块设计)

> [3.1 用户与权限模块 [7](#用户与权限模块)](#用户与权限模块)
>
> [3.2 报名管理模块 [7](#报名管理模块)](#报名管理模块)
>
> [3.3 面试管理模块 [7](#面试管理模块)](#面试管理模块)
>
> [3.4 通知中心模块 [7](#通知中心模块)](#通知中心模块)
>
> [3.5 数据统计模块 [7](#数据统计模块)](#数据统计模块)
>
> [3.6 工单（在线答疑）模块 [8](#工单在线答疑模块)](#工单在线答疑模块)

[第4章 前端设计 [8](#前端设计)](#前端设计)

> [4.1 前端架构 [8](#前端架构)](#前端架构)
>
> [4.2 页面结构 [9](#页面结构)](#页面结构)
>
> [4.3 路由设计 [10](#路由设计)](#路由设计)
>
> [4.4 UI设计/界面设计 [11](#ui设计界面设计)](#ui设计界面设计)

[第5章 后端设计 [12](#后端设计)](#后端设计)

> [5.1 后端整体架构 [12](#后端整体架构)](#后端整体架构)
>
> [5.2 核心业务设计 [14](#核心业务设计)](#核心业务设计)
>
> [5.3 异步任务 [20](#异步任务)](#异步任务)
>
> [5.4 文件存储设计 [20](#文件存储设计)](#文件存储设计)
>
> [5.5 接口设计 [22](#接口设计)](#接口设计)

[第6章 业务流程设计 [30](#业务流程设计)](#业务流程设计)

> [6.1 完整生命周期 [30](#完整生命周期)](#完整生命周期)
>
> [6.2 报名流程 [31](#报名流程)](#报名流程)
>
> [6.3 面试安排流程 [32](#面试安排流程)](#面试安排流程)
>
> [6.4 面试评分流程 [33](#面试评分流程)](#面试评分流程)
>
> [6.5 通知发生流程 [34](#通知发生流程)](#通知发生流程)
>
> [6.6 工单（在线答疑）处理流程 [35](#工单在线答疑处理流程)](#工单在线答疑处理流程)

[第7章 系统安全设计 [36](#系统安全设计)](#系统安全设计)

> [7.1 安全目标 [36](#安全目标)](#安全目标)
>
> [7.2 安全设计原则 [36](#安全设计原则)](#安全设计原则)
>
> [7.3 身份认证 [36](#身份认证)](#身份认证)
>
> [7.4 访问控制 [38](#访问控制)](#访问控制)
>
> [7.5 后端接口安全 [39](#后端接口安全)](#后端接口安全)
>
> [7.6 数据安全与隐私 [41](#数据安全与隐私)](#数据安全与隐私)

[第8章 日志与监控设计 [42](#日志与监控设计)](#日志与监控设计)

> [8.1 日志设计 [42](#日志设计)](#日志设计)
>
> [8.2 监控设计 [43](#监控设计)](#监控设计)

[第9章 性能设计 [45](#性能设计)](#性能设计)

> [9.1 性能目标与场景假设 [45](#性能目标与场景假设)](#性能目标与场景假设)
>
> [9.2 前端性能 [45](#前端性能)](#前端性能)
>
> [9.3 应用层性能（后端） [46](#应用层性能后端)](#应用层性能后端)
>
> [9.4 并发与接口防护设计 [46](#并发与接口防护设计)](#并发与接口防护设计)
>
> [9.5 数据库性能 [47](#数据库性能)](#数据库性能)

[第10章 部署设计 [49](#部署设计)](#部署设计)

> [10.1 部署整体架构 [49](#部署整体架构)](#部署整体架构)
>
> [10.2 环境说明 [49](#环境说明)](#环境说明)
>
> [10.3 后端部署方式 [50](#后端部署方式)](#后端部署方式)
>
> [10.4 前端部署方式 [51](#前端部署方式)](#前端部署方式)
>
> [10.5 配置文件管理 [53](#配置文件管理)](#配置文件管理)
>
> [10.6 数据库启动 [53](#数据库启动)](#数据库启动)

[第11章 非功能性需求设计 [54](#非功能性需求设计)](#非功能性需求设计)

> [11.1 可用性要求 [54](#可用性要求)](#可用性要求)
>
> [11.2 可维护性 [54](#可维护性)](#可维护性)
>
> [11.3 可扩展性 [54](#可扩展性)](#可扩展性)

# 文档概述

## 文档目的

本文档用于描述系统的详细设计方案，作为开发、测试、部署及后期维护的依据。

## 适用读者

- 后端开发工程师

- 前端开发工程师

- 测试工程师

- 项目经理

- 系统维护人员

## 系统范围

本系统旨在实现校园社团的线上报名、面试安排、评分、通知推送及管理端数据统计等业务流程。

## 引用资料

- 《需求规格说明书》

- 《原型设计文档》

- 前后端技术栈官方文档

# 系统总体设计

## 系统目标

提供一个统一平台，实现社团招新的报名、审核、面试、通知、统计管理。

## 系统角色

> 普通学生：报名参与、查看通知、查看面试安排
>
> 面试官：查看面试任务、提交评分与面试记录
>
> 社团管理员：管理报名、安排面试、查看数据统计

## 技术选型

> 前端：

- PC Web端：Vue3+Vite

- 手机H5端/微信小程序端：UniApp

> 后端：FastAPI
>
> 数据库：MySQL
>
> 对象存储：RustFS本地服务器部署
>
> 鉴权：JWT
>
> 部署：Docker
>
> 可选组件说明（后续扩展可用）

1.  Nginx反向代理网关：生产环境中可将Nginx部署在FastAPI前，用于HTTPS终止、静态资源托管、负载均衡和限流。当前环境为简化部署，FastAPI通过Uvicorn直接对外提供HTTP服务。

2.  Redis缓存/限流组件：后续可在登录限流、验证码、热点数据缓存等场景中接入Redis，实现更高并发能力。当前版本通过应用内内存计数/数据库查询满足场景。

## 系统架构图

![表格 AI 生成的内容可能不正确。](media/image1.png)

1.  系统架构图

## 系统模块划分

- 用户与权限管理

- 报名管理模块

- 面试管理模块

- 通知中心

- 数据统计模块

- 系统设置模块

- 工单（在线答疑）模块

# 功能模块设计

## 用户与权限模块

- 用户注册、登录、身份验证

- 角色区分：管理员、面试官、普通学生

- 权限控制基于RBAC

## 报名管理模块

- 报名表单填写

- 报名审核

- 状态通知

## 面试管理模块

- 创建面试场次

- 分配面试官

- 面试问题填写

- 面试记录、面试打分

- 录音上传、AI转写

- 面试结果统计

## 通知中心模块

- 系统通知

- 面试时间通知

- 状态变更通知

## 数据统计模块

- 报名数量统计

- 面试通过率统计

- 历史数据对比

## 工单（在线答疑）模块

- 创建工单

- 回复

- 状态流转

# 前端设计

## 前端架构

### H5/微信小程序端

框架：UniApp

UI组件库：uView 2.0

业务逻辑：Pinia状态管理

通信：uni.request

### PC Web端

框架：Vue3

构建工具：Vite

样式方案：Tailwind CSS

UI组件方案：shadcn-vue

业务逻辑：Pinia状态管理

通信：axios

## 页面结构

![](media/image2.png)![](media/image3.png)

## 路由设计

命名规范：/模块名/页面名/:id（动态参数）

### H5/微信小程序端

| 场景           | 使用方法              |
|----------------|-----------------------|
| TabBar页面跳转 | uni.switchTab({url})  |
| 普通页面跳转   | uni.navigateTo({url}) |
| 返回上一页     | uni.navigateBack()    |
| 替换当前页     | uni.redirectTo({url}) |

1.  路由跳转规范

[TABLE]

2.  H5/微信小程序端路由结构树

### PC Web端

管理员可以访问所有菜单，面试官只有部分菜单

1.  PC Web端路由结构树

[TABLE]

## UI设计/界面设计

系统UI设计基于Tailwind CSS设计规范，

统一定义颜色、间距、圆角、字体大小等样式变量，

通过shadcn-vue组件封装实现全局一致的交互体验。

# 后端设计

## 后端整体架构

### 技术栈

开发语言：Python 3.10+

Web 框架：FastAPI

Web Server：uvicorn

ORM：SQLModel

数据库：MySQL

鉴权：JWT

日志：Python logging + 统一日志封装

对象存储：RustFS（自建对象存储），后端仅存文件URL

### 架构风格

模块化单体应用：整体部署为一个后端服务进程，但内部按【领域模块】划分（用户与权限、报名、面试、通知、统计等），每个模块有较清晰的代码边界，方便后续系统规模扩展拆分为微服务。

标准三层（四层）架构：

- 接口层（API/Router/Controller）

- 业务层（Service）

- 数据访问层（DAO/Repository）

- 数据模型与对象层（Model/Schema）

### 目录结构设计

[TABLE]

1.  后端目录结构设计

## 核心业务设计

### 用户与权限模块

**主要实体**

> user用户表：存储账号基础信息（手机号、密码哈希、姓名、学校、专业、学号、身份证号码）
>
> role角色表：定义三种基础角色：

- ADMIN：系统管理员（拥有所有权限）

- CLUB_ADMIN：社团管理员

- INTERVIEWER：面试官

- STUDENT：普通学生

> user_role关系表：支持一个用户拥有多个角色（例如既是社团管理员又是面试官），对于普通学生角色（STUDENT），club_id可以为空，表示全局学生身份。

**核心业务逻辑**

1.  **注册**

- H5/PC通过「手机号+验证码」完成注册。

- 通过Service层：

> 1\. 校验验证码是否正确、未过期
>
> 2\. 校验手机号是否已注册
>
> 3\. 创建user记录，密码使用bcrypt等算法加密
>
> 4\. 按角色选择结果插入user_role记录

2.  **登录**

- 手机号+密码/手机号+验证码/微信授权登录

- 登录成功后生成：

> Access Token（短期有效，用于访问接口）
>
> Refresh Token（用于刷新Access Token）

- JWT Payload中包含：

> sub：用户ID
>
> roles：角色列表
>
> exp：过期时间

3.  **角色与权限控制RBAC**

- 基于角色控制访问：

> 管理端接口（PC）：仅CLUB_ADMIN/INTERVIEWER访问。
>
> 报名相关接口：STUDENT访问。

- 在Router上通过依赖注入完成权限校验，例如：

[TABLE]

4.  **个人资料与认证**

- 更改学校需要走人工审核流程：

> 创建profile_change_request记录，管理员审核后更新user表

- 更改手机号需要原手机号认证

- “校园认证”相关字段存入user的扩展字段或单独user_profile表

### 报名管理模块

对应前端新生端「报名」相关页面和PC端「报名管理」。

**主要实体**

> club社团表（如果需要多社团支持）
>
> department部门表：社团招新的部门
>
> position岗位表：社团招新的岗位与要求
>
> signup报名表：记录报名信息（用户、岗位、状态、审核结果、自述、附件）
>
> signup_session：报名主表（一个学生一次招新活动）
>
> signup_item：报名子表（一个学生在本次活动报了哪些部门/岗位）

**核心业务逻辑**

1.  **发布报名配置（管理员端）**

- 管理员在 PC 端创建社团、部门、岗位、关联面试场次，并设置报名起止时间、人数上限等。

- Service校验：

> 报名时间逻辑正确（开始\<结束）

2.  **新生提交报名**

- 手机前端提交报名表单：岗位选择、自述、附件等

- Service逻辑：

> 校验用户已登录
>
> 校验当前时间在报名时间范围内
>
> 校验是否已有有效报名（防止重复报名同一岗位）
>
> 校验附件格式、大小（在文件上传模块）
>
> 写入signup记录，初始状态为PENDING（待处理/待审核）

3.  **报名审核（管理员端）**

- 管理员在PC端可提前设置报名同时自动通过审核

- 管理员在 PC 端「报名审核」中查看列表、通过/拒绝

- Service 逻辑：

> 提交审核结果（APPROVED\`/\`REJECTED），可填写拒绝理由
>
> 写入审核时间、审核人ID
>
> 触发通知模块发送报名结果通知

4.  **报名记录查询**

- 学生端「报名记录」列表：按当前用户过滤signup表

- 管理端支持筛选条件：场次、岗位、审核状态、时间范围、学生姓名、学生学号、手机号

### 面试管理模块

对应PC端「面试管理」和H5端「开始面试」。

**主要实体**

> interview_session面试场次表：名称、时间、地点、状态
>
> interviewer_assignment面试官场次关系表
>
> interview_record面试记录表：面试官、记录文本、评分、录音URL、AI文本等
>
> interview_candidate候选人排期表（每个报名在某场次的安排）
>
> score_template评分模板
>
> score_item评分项表（配置每个评分项标题、权重、满分）
>
> interview_score面试评分明细表：每个评分项的得分

**核心业务逻辑**

1.  **创建/编辑面试场次**

- 管理员设置

> 场次基础信息（名称、时间、地点）
>
> 关联的报名
>
> 分配面试官
>
> 创建评分模板

- Service校验：

> 同一面试官同一时间段是否存在冲突场次

2.  **生成面试排表**

> 管理员按报名名单、时间段生成interview_candidate排期记录（只记录“谁在什么时候在哪个场次面试”，不提前创建面试记录）。
>
> 当某个面试官首次进入面试页面时，如果该候选人在本场次下还没有对应他的interview_record，系统即时创建一条空记录，后续录音、评语和评分都落在这条记录上。

3.  **面试过程记录**

> 面试官端（H5或PC）进入「开始面试」页面
>
> 显示候选人基本信息与历史报名信息
>
> 上传/录制录音，更新recording_url
>
> 拍摄候选人照片，更新face_image_url
>
> 记录面试过程文本

4.  **评分逻辑**

> interview_record.status取值：PENDING（待评分）、SCORED（已评分）。面试记录创建时为PENDING，首次提交评分后更新为SCORED。

- 加载当前场次的评分项score_item列表

- 面试官为每个评分项打分，系统自动计算加权总分（保留1位小数）

- Rating提交后

> interview_record.total_score更新
>
> interview_record.status更新为SCORED

5.  **结果确认与录取**

> 面试结束后，系统按场次汇总每个候选人的所有interview_record与评分，计算出候选人总分/平均分，并写回interview_candidate.final_score字段
>
> 社团管理员在 PC 端“录取管理/面试结果”页面，根据候选人得分与评语统一确定录取名单，为每个候选人创建或更新一条admission_result记录，写入录取结果（PASS/REJECT/WAITLIST）、岗位及备注。
>
> 面试官仅负责提交评分和评语，不具备直接修改录取结果的权限。
>
> 面试官仅负责提交评分和评语，不具备直接修改录取结果的权限。

### 通知中心模块

**主要实体**

> notification通知表：类型、标题、内容、发送时间、状态等
>
> notification_user用户通知表：每条通知与用户的映射，包含「已读状态」。

**通知类型**

系统通知（公告类）

报名相关通知（成功/审核结果）

面试日程通知（面试时间、地点）

面试结果通知

工单通知/答疑回复

**核心业务逻辑**

1.  **创建通知**

> 报名审核、面试场次发布、结果确认等业务流程在Service内调用notification_service.create_notification()写入记录

2.  **发送方式**

> 默认「站内通知」（H5/PC通知中心显示）
>
> 可扩展为邮件、短信（通过tasks.background_tasks异步发送）

3.  **阅读状态**

> 用户进入通知详情时，更新notification_user.read_status=READ
>
> 前端根据未读数量显示红点或角标

### 工单（在线答疑）模块

对应前端 H5 端「我的→在线答疑/工单」页面，以及PC端社团管理员/平台管理员的「工单管理」页面。

**主要实体**

> faq常见问题表：维护平台级/学校级/社团级FAQ，供学生自助查询。ticket工单主表：一条学生提问或反馈，对应一个问题生命周期。
>
> ticket_reply工单回复表：记录工单下的每条问答消息。

**核心业务逻辑**

1.  **学生提交工单**

> H5端「在线答疑」中，如果FAQ中未找到答案，学生可点击“我要提问”。提交内容包括：标题、问题描述、可选附件（截图、PDF说明等）。
>
> Service逻辑：

1.  校验用户已登录。

2.  自动填充school_id，若在某社团详情页中提问则附带club_id。

3.  创建ticket记录，初始status=OPEN、priority=NORMAL、assignee_id为空。

4.  同时创建首条ticket_reply记录（from_user_id 为学生本人）。

5.  调用通知模块，向对应社团管理员/平台管理员发送一条类型为TICKET的新工单提醒。

&nbsp;

2.  **管理员/社团管理员接单与回复**

> PC端“工单管理”页面中，管理员可以看到自己负责学校/社团范围内所有OPEN或IN_PROGRESS状态工单。
>
> 接单：将assignee_id设为当前用户，并将status更新为IN_PROGRESS。
>
> 回复：在工单详情页输入回复内容，写入一条ticket_reply，is_from_staff=1。
>
> 每次工作人员回复后，系统调用通知模块，向工单发起人发送一条“工单有新回复”的站内消息/邮件

3.  **学生追问与补充信息**

> 学生在H5端查看工单详情时，可以继续补充问题或追问，写入ticket_reply记录，is_from_staff=0。
>
> 工单状态保持为IN_PROGRESS，方便管理员继续跟进

4.  **工单解决与关闭**

> 当管理员认为问题已解决时，在PC端将工单状态更新为：

- RESOLVED：已解决待确认，同时设置 resolved_at。

- CLOSED：已关闭（例如重复问题、超时未响应等）。

> 学生在H5端看到状态为RESOLVED的工单后，可以点击“已解决”：

- 确认后状态更新为CLOSED；

- 若不满意，可以继续追问，系统自动将状态重新置回IN_PROGRESS

5.  **与FAQ的联动**

> 对于高频类似问题，管理员可以在PC端一键将某个已关闭工单内容整理为一条新的FAQ（写入faq表），后续学生通过FAQ即可自助解决，无需重复提问。

### 数据统计模块

统计模块主要通过聚合查询signup、interview_session、interview_record等表实现。

报名数量统计：按社团/场次/岗位/时间范围汇总

面试通过率统计：通过人数/参加面试人数

面试得分统计：平均分、分布（直方图）、按面试官维度统计

导出：提供导出为Excel的API，前端下载

## 异步任务

优先使用FastAPI自带的BackgroundTasks处理简单的「发通知」场景；对耗时较长的任务（如录音转写）可以模拟实现或采用简单轮询。

### 短信/邮件发送

- 触发点：

> 注册/登录验证码发送
>
> 报名结果、面试结果邮件

- 实现方式：

> Router调用Service完成主业务逻辑（例如报名审核），同时通过BackgroundTasks提交发送短信/邮件任务

### 录音转写

- 触发点：

> 面试录音文件上传成功后。

- 实现方式：

> 1.在interview_record中增加transcript_status字段（PENDING / PROCESSING / DONE/FAILED），以及transcript_text字段
>
> 2.上传录音后：
>
> 将transcript_status更新为PENDING
>
> 后台任务调用外部语音识别API（可在实现中简单mock，返回假数据满足课程需求）
>
> 成功后更新transcript_text和transcript_status=DONE
>
> 3.前端面试记录详情页轮询查询transcript_status，显示转写结果

## 文件存储设计

系统涉及的文件主要包括：

用户头像

社团证明材料（PDF/图片）

报名附件（作品集、简历）

面试录音文件

面试人脸照片

### 存储方案

使用自建对象存储服务RustFS，所有文件通过HTTP(S)访问。

数据库中仅存储文件相对路径和元数据，不直接存储二进制数据，由后端负责拼接完整URL，避免迁移或更换域名时出现问题。

### 目录与命名规范

对象存储RustFS路径命名规范：

[TABLE]

env：环境标识（dev/test/prod）

文件名使用uuid，避免重复和中文文件名问题。

### RustFS客户端设计

RustFS使用本地部署的对象存储系统，提供自有REST API或S3兼容API。后端通过utils/rustfs_client.py进行统一封装。

提供的核心方法：

- upload_file(local_path, remote_path) → 返回 file_url

- delete_file(remote_path)

- generate_private_url(remote_path, expires_in=3600)

- get_file_info(remote_path)

异常处理：

- 上传失败自动重试 3 次

- 网络错误记录 error log

- 存储空间不足时返回 507 Storage Insufficient

## 接口设计

说明：

- 「认证」列标明是否需要登录，以及需要的角色。

- 角色缩写：S=STUDENT，I=INTERVIEWER，C=CLUB_ADMIN，A=平台管理员

### 鉴权与用户模块（auth/users）

| 接口 | 方法 | 说明 | 认证 |
|:---|----|:---|----|
| /api/v1/auth/send-code | POST | 发送短信验证码（注册/登录场景） | 无 |
| /api/v1/auth/register | POST | 使用手机号+验证码注册账号并设置初始密码/角色 | 无 |
| /api/v1/auth/login | POST | 手机号+密码/验证码 登录，返回Access/Refresh Token | 无 |
| /api/v1/auth/token/refresh | POST | 使用Refresh Token刷新Access Token | 已登录 |
| /api/v1/auth/logout | POST | 执行服务端登出（Token吊销） | 已登录 |
| /api/v1/users/me | GET | 获取当前用户基本资料、角色列表及所属社团 | 已登录 |
| /api/v1/users/me | PUT | 修改当前用户资料（学校变更走审核、其他直接更新） | 已登录 |
| /api/v1/users/me/password | PUT | 修改密码，需要输入旧密码 | 已登录 |
| /api/v1/users/me/campus-verification | POST | 提交校园认证申请（上传学生证等）写入user_profile_request | 已登录 |
| /api/v1/admin/users | GET | 根据手机号/姓名/学校查询用户列表 | C/A |
| /api/v1/admin/users/{user_id}/roles | POST | 给用户分配/修改角色及club_id（写入user_role） | C/A |
| /api/v1/admin/profile-requests | GET | 查看资料修改/认证申请列表 | C/A |
| /api/v1/admin/profile-requests/{id}/approve | POST | 审核通过并更新user对应字段 | C/A |
| /api/v1/admin/profile-requests/{id}/reject | POST | 审核拒绝并写入remark | C/A |

### 社团/岗位/招新场次模块（club/recruitment）

| 接口 | 方法 | 说明 | 认证 |
|:---|----|:---|----|
| /api/v1/clubs | GET | 按学校查询社团列表，供 H5 首页展示 | 已登录 |
| /api/v1/clubs/{id} | GET | 社团详情（简介、部门、岗位、招新状态） | 已登录 |
| /api/v1/admin/clubs | POST | 社团管理员提交社团创建申请，上传证明材料 | 已登录（C申请） |
| /api/v1/admin/clubs/{id} | PUT | 更新社团基本信息、Logo、介绍等 | C |
| /api/v1/clubs/{club_id}/departments | GET | 查询社团部门列表 | 已登录 |
| /api/v1/clubs/{club_id}/departments | POST | 新增部门 | C |
| /api/v1/clubs/{club_id}/departments/{id} | PUT | 编辑部门信息 | C |
| /api/v1/clubs/{club_id}/departments/{id} | DELETE | 删除部门（逻辑删除） | C |
| /api/v1/clubs/{club_id}/positions | GET | 查询社团岗位列表及招新状态 | 已登录 |
| /api/v1/clubs/{club_id}/positions | POST | 创建岗位（名称、要求、人数） | C |
| /api/v1/clubs/{club_id}/positions/{id} | PUT | 编辑岗位信息 | C |
| /api/v1/clubs/{club_id}/positions/{id} | DELETE | 删除岗位（逻辑删除） | C |
| /api/v1/recruitment/sessions | GET | 查询某社团招新场次列表（PC/H5 共用） | C/已登录 |
| /api/v1/recruitment/sessions | POST | 创建招新场次（名称、时间、适用岗位） | C |
| /api/v1/recruitment/sessions/{id} | GET | 招新场次详情（含关联岗位列表） | 已登录 |
| /api/v1/recruitment/sessions/{id} | PUT | 编辑场次基本信息、报名时间、人数上限 | C |
| /api/v1/recruitment/sessions/{id} | DELETE | 关闭/删除招新场次 | C |
| /api/v1/recruitment/sessions/{id}/positions | POST | 关联或取消关联岗位 | C |

### 报名模块（signup）

学生端

| 接口 | 方法 | 说明 | 认证 |
|:---|----|:---|----|
| /api/v1/signup | POST | 提交报名：包含招新场次 ID、岗位列表、自我介绍、附加表单字段 | S |
| /api/v1/signup/my | GET | 当前用户的报名列表（按时间倒序） | S |
| /api/v1/signup/my/{id} | GET | 某次报名详情（主表+岗位+附件） | S |
| /api/v1/signup/my/{id} | DELETE | 撤销未审核/未开始面试的报名 | S |

管理员端

| 接口 | 方法 | 说明 | 认证 |
|:---|----|:---|----|
| /api/v1/admin/signup/applications | GET | 报名审核列表，支持按场次、岗位、状态、时间筛选 | C |
| /api/v1/admin/signup/applications/{id} | GET | 查看单条报名详情，包含附件和历史面试情况 | C/I（只读） |
| /api/v1/admin/signup/applications/{id}/audit | POST | 审核报名（通过/拒绝+原因），更新status | C |
| /api/v1/admin/signup/export | GET | 导出报名Excel，受频率限制 | C |

### 面试管理与评分模块（interview）

场次与规则配置（管理员端PC）

| 接口 | 方法 | 说明 | 认证 |
|:---|----|:---|----|
| /api/v1/interview/sessions | GET | 某社团面试场次列表（可按招新场次/时间/状态过滤） | C/I（只读） |
| /api/v1/interview/sessions | POST | 创建面试场次（时间、地点、关联招新场次/岗位） | C |
| /api/v1/interview/sessions/{id} | GET | 场次详情（包含已分配面试官和候选人数） | C/I |
| /api/v1/interview/sessions/{id} | PUT | 编辑场次信息（时间、地点、状态） | C |
| /api/v1/interview/sessions/{id}/assign-interviewers | POST | 为当前场次批量分配/调整面试官 | C |
| /api/v1/interview/sessions/{id}/generate-candidates | POST | 根据报名情况生成 interview_candidate 排期（可按规则排序） | C |
| /api/v1/interview/sessions/{id}/score-template | POST | 选择或自定义评分模板（写入 score_item） | C |

结果汇总与录取（管理员端）

| 接口 | 方法 | 说明 | 认证 |
|:---|----|:---|----|
| /api/v1/interview/sessions/{id}/results | GET | 某场次候选人得分汇总列表（包含各轮得分、平均分） | C |
| /api/v1/interview/candidates/{id}/decision | POST | 根据candidate_id写入admission_result表 | C |
| /api/v1/interview/sessions/{id}/export | GET | 导出某场次的面试结果表 | C |

面试任务与记录（面试官端）

| 接口 | 方法 | 说明 | 认证 |
|:---|----|:---|----|
| /api/v1/interview/my-tasks | GET | 当前面试官待处理的interview_candidate列表（按时间排序） | I |
| /api/v1/interview/candidates/{id} | GET | 某个候选人的排期详情+历史报名记录 | I |
| /api/v1/interview/records/{record_id} | GET | 加载指定面试记录（录音URL、文本、评分等） | I |
| /api/v1/interview/records/{candidate_id}/start | POST | 面试官点击“开始面试”：若无interview_record则创建一条 | I |
| /api/v1/interview/records/{record_id} | PUT | 更新面试记录文本、总结等（不含评分） | I |
| /api/v1/interview/records/{record_id}/score | POST | 提交评分：包含各评分项得分和备注，生成 interview_score，并更新 total_score 和 status=SCORED | I |
| /api/v1/interview/records/{record_id}/rescore | POST | 在允许时间内修改评分，记录操作日志，仅在当前记录status=SCORED且未被锁定（可根据时间窗口判断）时允许重评分，状态仍保持为SCORED | I |
| /api/v1/interview/records/{record_id}/upload-recording | POST | 上传面试录音文件，返回 RustFS URL，触发异步转写 | I |
| /api/v1/interview/records/{record_id}/upload-face | POST | 上传候选人现场照片 | I |

### 工单与FAQ模块（ticket/faq）

| 接口 | 方法 | 说明 | 认证 |
|:---|----|:---|----|
| /api/v1/faqs | GET | FAQ 列表，支持按关键字、分类、学校/社团过滤 | 已登录 |
| /api/v1/faqs/{id} | GET | FAQ 详情 | 已登录 |
| /api/v1/admin/faqs | POST | 创建 FAQ（从零编写或基于工单整理） | C/A |
| /api/v1/admin/faqs/{id} | PUT | 编辑 FAQ | C/A |
| /api/v1/admin/faqs/{id} | DELETE | 删除 FAQ | C/A |
| /api/v1/tickets | GET | 学生查看自己提交的工单列表（按状态筛选） | S |
| /api/v1/tickets | POST | 新建工单（标题+内容+可选附件） | S |
| /api/v1/tickets/{id} | GET | 工单详情 + 回复列表 | S/C/A |
| /api/v1/tickets/{id}/reply | POST | 追加一条回复，自动判定 is_from_staff | S/C/A |
| /api/v1/tickets/{id}/status | PATCH | 更新工单状态（OPEN/IN_PROGRESS/RESOLVED/CLOSED） | C/A |
| /api/v1/admin/tickets | GET | 管理端按学校/社团/状态查看工单列表 | C/A |

### 通知中心模块（notification）

| 接口 | 方法 | 说明 | 认证 |
|:---|----|:---|----|
| /api/v1/notifications | GET | 通知列表，支持按类型、是否已读分页查询 | 已登录 |
| /api/v1/notifications/{id} | GET | 通知详情，顺便将 read_status 置为 READ | 已登录 |
| /api/v1/notifications/unread-count | GET | 获取当前用户未读通知数量（用于小红点） | 已登录 |
| /api/v1/notifications/{id}/read | POST | 主动标记为已读 | 已登录 |
| /api/v1/admin/notifications | GET | 管理端查看已发送通知记录（按时间、类型筛选） | C/A |

### 统计模块（stats）

| 接口 | 方法 | 说明 | 认证 |
|:---|----|:---|----|
| /api/v1/stats/overview | GET | 仪表盘总览：报名人数、面试人数、通过率等 | C |
| /api/v1/stats/recruitment | GET | 按招新场次/岗位统计报名人数及通过率 | C |
| /api/v1/stats/interview | GET | 按面试场次统计平均分、得分分布、各面试官打分情况 | C |
| /api/v1/stats/export | GET | 导出统计报表（Excel/PDF） | C |

# 业务流程设计

## 完整生命周期

![](media/image4.png)

![](media/image5.png)

## 报名流程

![](media/image6.png)

说明：

| 步骤 | 发起方 | 描述                                 |
|------|--------|--------------------------------------|
| 1    | 学生   | 在 H5 端进入社团招新场次，点击报名   |
| 2    | 系统   | 校验报名时间、岗位、是否重复报名等   |
| 3    | 系统   | 创建报名主表与子表数据（支持多岗位） |
| 4    | 管理员 | 在 PC 后台审核报名（通过/拒绝）      |
| 5    | 系统   | 状态变化后触发通知模块创建用户通知   |
| 6    | 学生   | 在通知中心接收报名审核结果           |

## 面试安排流程

![](media/image7.png)

说明：

| 步骤 | 发起方 | 描述                                                       |
|------|--------|------------------------------------------------------------|
| 1    | 管理员 | 创建面试场次（interview_session）                          |
| 2    | 管理员 | 关联岗位与候选人报名记录                                   |
| 3    | 系统   | 校验时间冲突（同一面试官、同一候选人不能重叠）             |
| 4    | 管理员 | 分配面试官、设置评分模板（score_item）                     |
| 5    | 系统   | 生成 interview_candidate 排期记录（planned_start_time 等） |
| 6    | 系统   | 创建面试时间通知，并推送给学生                             |

## 面试评分流程

![](media/image8.png)

说明：

| 步骤 | 发起方     | 描述                                        |
|------|------------|---------------------------------------------|
| 1    | 面试官     | 查看自己的面试任务（interview_candidate）   |
| 2    | 系统       | 若不存在interview_record，则创建一条空记录  |
| 3    | 面试官     | 上传录音、拍照，填写面试记录文本            |
| 4    | 系统       | 对录音进行后台异步转写（transcript_status） |
| 5    | 面试官     | 根据评分模板填写评分                        |
| 6    | 系统       | 将每项评分写入interview_score，并计算总分   |
| 7    | 系统       | 更新interview_record状态为SCORED            |
| 8    | 社团管理员 | 依据评分筛选录取人员                        |

## 通知发生流程

![](media/image9.png)

说明：

| 步骤 | 描述                                                |
|------|-----------------------------------------------------|
| 1    | 各业务模块在状态变化时调用通知服务创建通知记录      |
| 2    | 系统生成 notification，按用户生成 notification_user |
| 3    | 若有 scheduled_at，则进入定时队列等待执行           |
| 4    | 实际发送后更新 sent_at、status                      |
| 5    | 用户访问通知详情时修改 read_status = READ           |

## 工单（在线答疑）处理流程

![](media/image10.png)

# 系统安全设计

本系统为学生招新报名与面试管理平台，涉及用户账号、报名信息、面试成绩、附件文件、面试录音等多类敏感数据。本章从认证、访问控制、数据安全、接口安全、防攻击、文件安全与审计监控等多个维度进行完整安全设计。

## 安全目标

| 目标 | 描述 |
|----|----|
| 机密性 Confidentiality | 防止未授权用户获取敏感数据（如身份证号、手机号、报名附件、面试录音）。 |
| 完整性 Integrity | 确保报名信息、面试结果、评分记录不可被恶意篡改。 |
| 可用性 Availability | 系统在恶意攻击、刷接口情况下仍可正常服务。 |
| 可审计性 Accountability | 系统能追踪所有关键操作与安全事件（登录、权限拒绝、数据导出等）。 |

## 安全设计原则

> 最小权限原则（Least Privilege）:用户只能访问与其身份相关内容。
>
> 纵深防御（Defense in Depth）:多层保护（前端+后端+数据库+文件存储）。
>
> 默认拒绝（Default Deny）:所有接口默认拒绝访问，需要显式授权。
>
> 输入验证（Input Validation）:所有输入必须在进入业务前验证。
>
> 安全优先（Security First）:安全是设计的基础，不是附加功能。

## 身份认证

系统采用手机号+密码/验证码的注册登录方式，并使用JWT进行无状态认证。

### 账户与密码安全策略

1.  密码存储

- 全部使用bcrypt（默认12~14cost）哈希存储

- 禁止存储明文密码

- 禁止在日志中输出密码

2.  密码规则

- 至少 8 位，必须包含大小写+数字（可根据课程要求调整）

- 密码修改逻辑：必须验证旧密码,修改后强制所有Token失效

3.  验证码登录安全

- 验证码的有效期：5分钟

- 一次性使用（使用后立即失效）

- 限制发送频率：1分钟内仅可发送一次,每天最多10次验证码

- 采用随机 4-6 位数字，不可预测

### JWT会话管理

1.  Access Token

> 有效期30分钟
>
> 仅包含必要信息：

[TABLE]

2.  Refresh Token

> 有效期7天
>
> 仅用于刷新Access Token
>
> 传输方式：
>
> 全端（PC Web、H5、小程序）统一使用HTTP Header传输Token，格式为：Authorization:Bearer\<token\>。FastAPI后端将通过依赖注入统一解析此 Header，无需针对 Cookie 做特殊处理。
>
> PC Web端：
>
> 登录成功后将Token存储于LocalStorage或Cookie（非HttpOnly，需允许JS读取）中，每次请求拦截器手动取出Token放入Header。
>
> H5/小程序端：
>
> 保持使用本地安全存储（Storage），请求时放入Header。

3.  Token吊销机制

> 当以下情况发生时，立即失效Token：

- 修改密码

- 退出登录

- 管理员禁用账号

- 注销所有设备

> 实现方式：在user表中维护token_version字段，每次关键操作自增
>
> 后端校验：

[TABLE]

### 登录限流与防爆破

同一账号连续5次失败→冻结10分钟

同一IP登录失败超过阈值→自动加入灰名单

登录接口绑定图形验证码（可选）

## 访问控制

系统采用RBAC + 数据权限（ABAC）混合模式。

### 角色模型

一个账号可以在不同社团拥有不同角色。例如：user_id=23在A社团是管理员，在B社团是面试官

| 标识        | 名称       | 权限范围                             |
|-------------|------------|--------------------------------------|
| STUDENT     | 普通学生   | 报名、查看通知                       |
| INTERVIEWER | 面试官     | 查看报名、填写面试评分、管理面试记录 |
| CLUB_ADMIN  | 社团管理员 | 管理招新、面试安排、公告、导出数据   |

1.  角色模型权限表

| **功能**                 | **学生** | **面试官** | **社团管理员** |
|--------------------------|:--------:|:----------:|:--------------:|
| 填写报名表               |    ●     |     \-     |       \-       |
| 审核报名                 |    \-    |     \-     |       ●        |
| 查看分配给自己的面试任务 |    \-    |     ●      |       \-       |
| 提交评分                 |    \-    |     ●      |       \-       |
| 设置招新配置/场次        |    \-    |     \-     |       ●        |
| 查看统计报表             |    \-    |     \-     |       ●        |

2.  权限矩阵表

### 接口级访问控制

通过FastAPI的依赖注入：

[TABLE]

效果：未携带JWT返回401，身份合法但角色不足返回403。

所有接口默认禁止访问，除非明确标注。

### 数据级访问控制（ABAC）

即使角色正确，也必须校验数据归属。以报名表signup_session为例：

- 学生只能查看自己的报名：

[TABLE]

- 社团管理员只能查看自己社团的报名：

signup_session本身没有club_id，需要通过recruitment_session关联社团

[TABLE]

- 社团管理员只能管理自己社团的数据，不可跨社团操作：

> 若面试官有多个社团身份，可以通过user_role查询其club_id列表

[TABLE]

## 后端接口安全

### 输入与输出安全

1.  严格输入校验（Pydantic）

- 字符串长度

- 正则校验

- email/phone 格式校验

- 数字范围校验

- 必填字段

2.  避免信息泄露

> 错误信息不包含：

- 数据库名

- SQL 语句

- 堆栈信息

> 统一格式：

[TABLE]

### 接口限流

| 接口     | 频率限制         |
|----------|------------------|
| 登录     | 20次/分钟/IP     |
| 验证码   | 10次/天/手机号   |
| 数据导出 | 每小时3次/管理员 |
| 面试评分 | 每分钟30次/用户  |

### 异常与错误码规范

1.  常见错误码表

| **code** | **场景**            |
|----------|---------------------|
| 400      | 参数校验失败        |
| 401      | 未登录或 Token 失效 |
| 403      | 权限不足            |
| 404      | 资源不存在          |
| 409      | 重复报名            |
| 429      | 请求过于频繁        |
| 500      | 服务器内部错误      |

通用响应结构common.py：

[TABLE]

## 数据安全与隐私

### 数据分类分级

| 等级             | 数据类型                 | 加密/脱敏策略              |
|------------------|--------------------------|----------------------------|
| 一级（高度敏感） | 身份证号、人脸照片、录音 | 库存密、访问控制、日志记录 |
| 二级（敏感）     | 手机号、报名附件         | 脱敏展示、私有对象存储     |
| 三级（普通）     | 姓名、报名信息           | RBAC 控制                  |

### 数据库存储安全

1.  数据库用户权限最小化

> 应用数据库用户仅授予：SELECT, INSERT, UPDATE, DELETE
>
> 禁止：DROP, ALTER, GRANT, SUPER

2.  防 SQL 注入

> 所有查询使用 ORM/预编译语句
>
> 禁止任何字符串拼接 SQL

3.  逻辑删除

> 所有业务表均带：is_deleted TINYINT、deleted_at DATETIME
>
> 避免误删导致的数据损坏。

# 日志与监控设计

本章介绍系统在运行过程中如何记录重要日志、监控接口健康度，并在出现异常时及时发现问题。设计目标是：便于排查问题、保证系统稳定、满足基本的审计需求。

## 日志设计

系统日志分为三类：访问日志、操作日志、错误日志。日志采用FastAPI内置logging机制输出，开发环境打印在控制台，生产环境写入文件。

### 访问日志

用于记录每一次API请求，便于排查接口耗时和访问行为。

记录内容包含：

> 请求时间
>
> 请求方式（GET/POST）
>
> 接口路径
>
> 用户ID（未登录则为空）
>
> IP地址
>
> 响应状态码
>
> 接口耗时

作用：

> 分析性能瓶颈
>
> 查看接口是否被恶意频繁访问
>
> 排查请求参数错误

### 操作日志

记录系统中较“关键的业务行为”，用于后期审计与回溯。

记录内容包括：

> 操作人（user_id）
>
> 操作时间
>
> 操作类型（如“报名审核”“提交评分”）
>
> 操作对象（报名 ID、面试记录 ID）
>
> 操作结果（成功/失败）

写入操作日志的场景（举例）：

> 报名审核通过/拒绝
>
> 面试官提交评分
>
> 管理员发布面试场次
>
> 用户修改个人信息

### 错误日志

记录后端执行出现的异常，用于快速排查问题。

记录内容包括：

> 错误发生时间
>
> 错误接口路径
>
> 用户ID（如有）
>
> 错误信息
>
> 异常堆栈（traceback）

常见场景：

> 数据库写入失败
>
> 上传文件失败
>
> 外部服务调用失败（如RustFS）

## 监控设计

系统监控主要从性能、稳定性、错误情况三个方面进行简单的指标采集，以便了解系统是否正常运行。

### 基本监控指标

| 类别       | 指标                  | 用途                |
|------------|-----------------------|---------------------|
| 性能监控   | 接口耗时（平均/最大） | 判断接口是否变慢    |
| 稳定性监控 | 请求成功率、失败率    | 判断系统是否异常    |
| 访问监控   | 每分钟请求数（QPS）   | 判断是否被恶意访问  |
| 数据库监控 | 慢查询次数            | 判断SQL是否需要优化 |

1.  监控内容表

监控方式：

> FastAPI中间件记录访问耗时
>
> 日志按天输出，开发者可根据日志手动分析
>
> 若部署到服务器，可用简单脚本统计错误量和访问量

### 文件上传监控

系统涉及录音、人脸照片、报名附件等文件上传，因此重点关注：

> 上传失败次数
>
> 文件大小异常
>
> 上传耗时过长

用于排查对象存储（RustFS）上传失败、网络质量问题等。

# 性能设计

## 性能目标与场景假设

1.  **QPS目标**

> 日常：≥50QPS
>
> 招新高峰（短时间集中报名/查询）：可支撑100QPS左右的瞬时请求

2.  **响应时间**

> 一般业务接口（报名列表、面试列表等）：80%请求\<300ms，99%请求\<1s
>
> 文件上传/导出等耗时接口：允许1–5s

3.  **并发用户数**

> 日常并发在线用户：几十级
>
> 招新高峰并发：数百学生同时浏览报名、提交表单

以上指标均基于：单台后端实例+单台MySQL实例+单台RustFS对象存储的基础部署结构。

## 前端性能

1.  **H5/小程序端**

页面结构层级控制在3层以内，避免过深递归导致渲染性能下降。

列表页（社团列表、报名记录、通知列表）都使用分页/下拉加载：

> 每页限制项目数量，滚动到底再加载下一页
>
> 当数据为空时显示空状态，避免额外请求

图片与文件：

> 社团Logo、学生头像采用小尺寸缩略图
>
> 面试人脸照片上传前可在前端进行压缩（如限制在几百KB以内）

2.  **PC Web端**

使用前端路由懒加载，将各大模块（报名管理、面试管理、统计等）拆分为独立chunk，避免一次性加载所有页面资源。

统计页图表：

> 默认展示最近一段时间的数据（如7天），需要历史数据时再按需请求
>
> 表格数据使用分页+前端排序，不一次性渲染上万条记录

## 应用层性能（后端）

1.  **合理拆分接口与返回字段**

列表接口仅返回概览字段，详情字段在详情接口中单独查询：

- 报名列表只返回：姓名、学号、岗位名称、状态、时间等

- 详情接口才返回完整自我介绍、附件列表等

避免一次接口返回过大JSON，减轻序列化及网络传输压力。

2.  **统一分页查询**

> 所有可能产生“长列表”的接口统一采用分页规则：
>
> 默认page_size=10~20，最大不超过50
>
> 典型列表：
>
> 报名记录列表signup_session/signup_item
>
> 面试记录列表interview_record
>
> 通知列表notification_user
>
> 接口统一入参：
>
> page（从1开始）
>
> page_size
>
> 接口统一出参：
>
> items（当前页数据）
>
> total（总条数）
>
> page/page_size（回显）

3.  **异步与后台任务减压**

对录音转写、通知发送、邮件发送等耗时操作全部放入后台任务处理，避免阻塞主请求流程。

前端在提交面试记录后，只需得到“已受理”结果，转写结果通过轮询或刷新详情页获取。

## 并发与接口防护设计

### 防重复提交与幂等性

典型需要防重复的场景：报名提交（同一场次重复点击提交）、面试评分提交（避免双击按钮导致成绩重复或覆盖）

实现方案：

1.  前端防重复

> 提交按钮点击后立即置为“加载中/禁用状态”
>
> 等后端返回结果再恢复
>
> 搜索接口增加300ms防抖

2.  后端幂等校验

> 报名提交：校验同一user_id+recruitment_session_id是否已存在有效记录，如存在则返回“已报名”提示而非重复插入。
>
> 面试评分：对每个interview_record仅允许在“未评分”状态下创建评分记录，评分后状态变为“已评分”，再次提交直接拒绝或进入“修改评分”流程。

### 接口限流与简单降级

1.  对“高开销接口”设置更严格频率限制：

> 导出报表：每个用户每小时最多3次
>
> 全量列表导出时限制最大导出条数（如1000条）

2.  系统负载过高时的简易降级（手动）：

> 暂时关闭批量导出、AI转写等非核心能力
>
> 保证报名、面试排期、通知等核心功能正常

当前实现中，限流计数可以采用应用内内存或数据库统计来模拟；若未来接入 Redis，可将登录、验证码、导出等限流逻辑迁移到 Redis 实现的分布式限流，以支撑更高并发。

## 数据库性能

数据库采用MySQL 8.0+InnoDB引擎，按模块划分多张表（用户、报名、面试、通知、工单等）。针对典型查询场景进行索引规划与SQL优化。

### 主键与通用字段

每张业务表均使用BIGINT UNSIGNED AUTO_INCREMENT作为主键，自增、聚簇索引。

全表统一created_at、updated_at、is_deleted字段，配合索引支持：

- 按时间倒序查询（最近报名、最近面试）

- 逻辑删除过滤（is_deleted=0）

### 关键索引设计

设计原则：

所有列表默认按created_at DESC排序→将created_at放入索引尾部有利于排序

优先对where条件+order by条件建立联合索引

避免对低选择性字段（如status）单独建索引，可作为联合索引的一部分

- 报名相关

| signup_session (user_id, recruitment_session_id, is_deleted)            |
|-------------------------------------------------------------------------|
| signup_item (signup_session_id, department_id, position_id, is_deleted) |

- 面试相关

| interview_session (club_id, start_time, status, is_deleted)              |
|--------------------------------------------------------------------------|
| interview_candidate (session_id, planned_start_time, is_deleted)         |
| interview_record(session_id,candidate_user_id,interviewer_id,is_deleted) |

- 通知相关

| notification_user (user_id, read_status, created_at, is_deleted) |
|------------------------------------------------------------------|

# 部署设计

## 部署整体架构

![图片包含 日程表 AI 生成的内容可能不正确。](media/image11.png)

特点：

- FastAPI通过 Uvicorn 直接处理所有 API 请求

- 小程序/H5：通过url=http://server-ip:8000/api/...（生产环境由Nginx提供HTTPS）

- PC Web：直接访问打包后的dist文件里的JS+API调用FastAPI

- RustFS作为独立服务（可通过Docker部署），与FastAPI同在内网，通过HTTP/S3协议交互

## 环境说明

| 环境              | 用途     |
|-------------------|----------|
| 开发环境（local） | 本地调试 |
| 测试环境（test）  | 功能测试 |
| 生产环境（prod）  | 正式运行 |

## 后端部署方式

- **方式一：直接启动**

| uvicorn main:app --host 0.0.0.0 --port 8000 |
|---------------------------------------------|

适用于：

- 本地部署

- 校内服务器部署

- 小规模访问（几十～百级用户）

&nbsp;

- **方式二：Docker部署**

> Dockerfile：

[TABLE]

> docker-compose.yml

[TABLE]

## 前端部署方式

### UniApp-H5端

构建H5，用http-server/serve托管dist：

| http-server ./dist -p 3000 |
|----------------------------|

### UniApp-微信小程序

直接上传即可，无需部署

API调用FastAPI接口

### Vue3 PC Web端

方式一：通过vite preview生产预览

[TABLE]

方式二：用 Node.js 本地服务器

[TABLE]

## 配置文件管理

使用.env管理环境配置：

[TABLE]

FastAPI使用Pydantic自动加载。

## 数据库启动

数据库启动已包括在docker-compose中，如需单独启动则进行以下命令：

| docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root123 mysql:8.0 |
|------------------------------------------------------------------|

# 非功能性需求设计

## 可用性要求

**系统可用性目标**

> 运行可用率目标：≥99%
>
> 后端异常自动重启（如 Docker restart policy）

**容错机制**

> 多数接口出现异常时返回友好错误信息，如“系统繁忙，请稍后再试”
>
> OSS 文件上传失败时允许用户重新上传
>
> 录音转写失败可使用“重新转写”按钮触发后台任务

**降级策略**

> 在高峰期或服务器性能不足时：
>
> 暂时关闭数据导出、AI 转写等非核心功能
>
> 核心功能（报名、面试、通知）始终保持可用

## 可维护性

**代码结构要求**

> 后端采用模块化目录结构：api/service/repository/models分层清晰
>
> 前端采用组件化开发，公共组件统一维护

**日志规范**

系统应记录三类日志（已在日志与监控部分详细说明），日志按天归档，便于查阅与调试。

**配置管理**

> 所有环境配置（数据库、OSS、JWT）全部放在.env
>
> 不允许将明文密码、密钥写入代码仓库

## 可扩展性

**模块扩展**

> 系统按“模块化单体架构”设计，使新增业务更容易扩展，例如：
>
> 后续可新增“群面模式”、“多轮面试”、“AI 面评”等
>
> 评分模板、报名表单、通知方式均已预留扩展字段

**数据扩展**

> MySQL表统一使用自增主键与InnoDB引擎，支持水平扩展
>
> 当前为单体架构，系统启用物理外键保障一致性，未来拆分微服务时可以考虑弱化外键，改由业务保证约束

**部署扩展**

> 现阶段单机部署即可满足使用
>
> 若未来访问量增加，可通过以下方式扩展：

- FastAPI增加worker数量

- 数据库主从读写分离

- RustFS自动扩容
